@using Ext.Net
@using Ext.Net.MVC

@{
    ViewBag.Title = "待处理隐患预警";
    Layout = "~/Views/Shared/_BaseLayout.cshtml";
    var X = Html.X();
}

@section headtag
{
    <script>
    </script>
}

@section menu
{
    @(
        X.GridPanelForModel()
            .Title("待处理")
            .ID("ThreatGrid")
            .Frame(true)
            .Height(400)
            
            .Plugins(
                    X.FilterHeader()
                )

            .SelectionModel(
                Html.X().RowSelectionModel()
                    .Mode(SelectionMode.Single)
                    .ID("GridSelector")
                    .Listeners(l =>
                    {
                        l.Select.Handler = "App.ThreatCaseDetailWin.show(this);";
                    })
            )
    )

    @(X.Window()
          .ID("ThreatCaseDetailWin")
          .Width(700)
          .Height(400)
          .Modal(true)
          .AutoRender(false)
          .AutoScroll(false)
          .Collapsible(false)
          .ConstrainHeader(true)
          .Constrain(true)
          .Maximized(true)
          .Maximizable(false)
          .Resizable(false)
          .Hidden(true)
          .Loader(X.ComponentLoader()
              .Url(Url.Action("Detail"))
              .Params(new Parameter("threatCaseId","App.ThreatGrid.getSelectionModel().getLastSelected().get('ThreatCaseId')",ParameterMode.Raw))
              .Mode(LoadMode.Frame)
              .LoadMask(lm => lm.ShowMask = true)
          )
          .Listeners(ls =>
          {
              ls.BeforeHide.Handler = "document.location.reload();";
              ls.BeforeClose.Handler = "document.location.reload();";
          }))
}