@using System.Activities.Statements
@using VentureManagement.Models
@{
    ViewBag.Title = "权限管理";
    Layout = "~/Views/Shared/_BaseLayout.cshtml";
    var X = Html.X();
}

@section headtag
{
    <script>
        var addRecord = function (grid) {
            var r = Ext.create({
                RoleName: "角色名"
            });
            grid.store.insert(0, r);
            form.getForm().reset();
        };
    </script>

}

@section menu
{
    @(
        X.GridPanel()
            .Title("权限列表")
            .ID("PermissionGrid")
            .Frame(true)
            .Height(400)
            .TopBar(
                Html.X().Toolbar()
                    .Items(
                        Html.X().Button()
                            .Text("保存")
                            .Icon(Icon.Disk)
                            .DirectEvents(de =>
                            {
                                de.Click.Url = Url.Action("UpdatePermissions");
                                de.Click.ExtraParams.Add(new Parameter
                                {
                                    Name = "data",
                                    Value = "this.up('grid').store.getChangedData()",
                                    Mode = ParameterMode.Raw,
                                    Encode = true
                                });
                            })
                            
                        //Html.X().Button()
                        //    .Text("增加")
                        //    .Icon(Icon.UserAdd)
                        //    .Handler("addRecord(App.PermissionGrid);"),
                            
                        //Html.X().Button()
                        //    .Text("删除")
                        //    .Icon(Icon.UserAdd)
                        //    .Handler("this.up('grid').deleteSelected(); App.UserForm.getForm().reset();")
                        )
                    )
            .Store(
                    Html.X().Store()
                    .PageSize(15)
                    .DataSource(Model)
                    .ID("UserGridStore")
                    .Model(
                        Html.X().Model()
                        .IDProperty("RoleId")
                        .Fields(
                            new ModelField("RoleId",ModelFieldType.Int),
                            new ModelField("RoleName",ModelFieldType.String),
                            new ModelField("Description",ModelFieldType.String),
                            new ModelField(Role.PermissionStrings[0], ModelFieldType.Boolean),
                            new ModelField(Role.PermissionStrings[1], ModelFieldType.Boolean),
                            new ModelField(Role.PermissionStrings[2], ModelFieldType.Boolean),
                            new ModelField(Role.PermissionStrings[3], ModelFieldType.Boolean),
                            new ModelField(Role.PermissionStrings[4], ModelFieldType.Boolean),
                            new ModelField(Role.PermissionStrings[5], ModelFieldType.Boolean),
                            new ModelField(Role.PermissionStrings[6], ModelFieldType.Boolean),
                            new ModelField(Role.PermissionStrings[7], ModelFieldType.Boolean),
                            new ModelField(Role.PermissionStrings[8], ModelFieldType.Boolean),
                            new ModelField(Role.PermissionStrings[9], ModelFieldType.Boolean),
                            new ModelField(Role.PermissionStrings[10], ModelFieldType.Boolean),
                            new ModelField(Role.PermissionStrings[11], ModelFieldType.Boolean),
                            new ModelField(Role.PermissionStrings[12], ModelFieldType.Boolean),
                            new ModelField(Role.PermissionStrings[13], ModelFieldType.Boolean)@*,
                            new ModelField(Role.PermissionStrings[14], ModelFieldType.Boolean),
                            new ModelField(Role.PermissionStrings[15], ModelFieldType.Boolean),
                            new ModelField(Role.PermissionStrings[16], ModelFieldType.Boolean),
                            new ModelField(Role.PermissionStrings[17], ModelFieldType.Boolean)*@
                        )
                    )
                    .ServerProxy(
                        Html.X().AjaxProxy()
                            .Url(Url.Action("GetData"))
                    )                                       
                )
                    
            .ColumnModel(
                Html.X().Column().Text("Id").DataIndex("RoleId").Hidden(true),
                Html.X().ComponentColumn().Text("角色名").DataIndex("RoleName").EmptyCellText("不能为空")
                    .OverOnly(true).Editor(true).Component(Html.X().TextField()
                    .AllowBlank(false).EmptyText("角色名最少两个字")),
                Html.X().ComponentColumn().Text("备注").DataIndex("Description").EmptyCellText("不能为空")
                    .OverOnly(true).Editor(true).Component(Html.X().TextField()
                    .AllowBlank(false).EmptyText("不能为空")).Hidden(true),
                Html.X().CheckColumn().Text(Role.PermissionStrings[0]).DataIndex(Role.PermissionStrings[0]).Editable(true),
                Html.X().CheckColumn().Text(Role.PermissionStrings[1]).DataIndex(Role.PermissionStrings[1]).Editable(true),
                Html.X().CheckColumn().Text(Role.PermissionStrings[2]).DataIndex(Role.PermissionStrings[2]).Editable(true),
                Html.X().CheckColumn().Text(Role.PermissionStrings[3]).DataIndex(Role.PermissionStrings[3]).Editable(true),
                Html.X().CheckColumn().Text(Role.PermissionStrings[4]).DataIndex(Role.PermissionStrings[4]).Editable(true),
                Html.X().CheckColumn().Text(Role.PermissionStrings[5]).DataIndex(Role.PermissionStrings[5]).Editable(true),
                Html.X().CheckColumn().Text(Role.PermissionStrings[6]).DataIndex(Role.PermissionStrings[6]).Editable(true),
                Html.X().CheckColumn().Text(Role.PermissionStrings[7]).DataIndex(Role.PermissionStrings[7]).Editable(true),
                Html.X().CheckColumn().Text(Role.PermissionStrings[8]).DataIndex(Role.PermissionStrings[8]).Editable(true),
                Html.X().CheckColumn().Text(Role.PermissionStrings[9]).DataIndex(Role.PermissionStrings[9]).Editable(true),
                Html.X().CheckColumn().Text(Role.PermissionStrings[10]).DataIndex(Role.PermissionStrings[10]).Editable(true),
                Html.X().CheckColumn().Text(Role.PermissionStrings[11]).DataIndex(Role.PermissionStrings[11]).Editable(true),
                Html.X().CheckColumn().Text(Role.PermissionStrings[12]).DataIndex(Role.PermissionStrings[12]).Editable(true),
                Html.X().CheckColumn().Text(Role.PermissionStrings[13]).DataIndex(Role.PermissionStrings[13]).Editable(true)@*,
                Html.X().CheckColumn().Text(Role.PermissionStrings[14]).DataIndex(Role.PermissionStrings[14]).Editable(true),
                Html.X().CheckColumn().Text(Role.PermissionStrings[15]).DataIndex(Role.PermissionStrings[15]).Editable(true),
                Html.X().CheckColumn().Text(Role.PermissionStrings[16]).DataIndex(Role.PermissionStrings[16]).Editable(true),
                Html.X().CheckColumn().Text(Role.PermissionStrings[17]).DataIndex(Role.PermissionStrings[17]).Editable(true)*@
            )
            .View(Html.X().GridView().StripeRows(true))   
            .BottomBar(
                Html.X().PagingToolbar()
                    .BeforePageText("页")
                    .AfterPageText("第{0}页")
                    .DisplayInfo(true)
                    .DisplayMsg("显示角色 {0} - {1} 共 {2}")
                    .EmptyMsg("没有数据"))
            )
}
