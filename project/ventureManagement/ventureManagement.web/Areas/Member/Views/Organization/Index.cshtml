@{
    ViewBag.Title = "TreeGrid - Ext.NET MVC Examples";
    Layout = "~/Views/Shared/_BaseLayout.cshtml";
    var X = Html.X();
}

@section headtag
{
    <script>
        var formatHours = function (v) {
            if (v < 1) {
                return Math.round(v * 60) + " mins";
            } else if (Math.floor(v) !== v) {
                var min = v - Math.floor(v);
                return Math.floor(v) + "h " + Math.round(min * 60) + "m";
            } else {
                return v + " hour" + (v === 1 ? "" : "s");
            }
        };

        var handler = function (grid, rowIndex, colIndex, actionItem, event, record, row) {
            Ext.Msg.alert('Editing' + (record.get('done') ? ' completed task' : ''), record.get('task'));
        };
    </script>
}

@section menu
{
    @(
        X.TreePanel()
            .ID("OrganizationTreePanel")
            .Title("Core Team Projects")
            .Layout(LayoutType.Fit)
            .Collapsible(false)
            .UseArrows(true)
            .RootVisible(true)
            .MultiSelect(true)
            .SingleExpand(true)
            .FolderSort(true)
            .TopBar(Html.X().Toolbar()
                            .Items(Html.X().Button()
                                .Text("Save All Events")
                                .Icon(Icon.Disk)
                            )
                        )
            //.Tools(X.Tool()
            //.Type(ToolType.Refresh)
            //.Handler("Ext.Msg.alert('Message','Refresh Tool Clicked!');")
            //)
            .Fields(
                X.ModelField().Name("organizationName"),
                X.ModelField().Name("Description"),
                X.ModelField().Name("checked").Type(ModelFieldType.Boolean)
                
            )
            .ColumnModel(    
                X.CheckColumn()
                    .Text("选中")
                    .DataIndex("checked")
                    .Width(40)
                    .Editable(true)
                    .StopSelection(false),
            
                X.TreeColumn()
                    .Text("部门")
                    .DataIndex("organizationName"),
                    
                X.Column()
                    .Text("备注")
                    .DataIndex("Description"),                    
        
                X.ActionColumn()
                    .Text("编辑")
                    .Width(40)
                    .MenuDisabled(true)
                    .Align(Alignment.Center)
                    .Items(
                        X.ActionItem()
                            .Tooltip("Edit task")
                            .Icon(Icon.PageWhiteEdit)
                            .Handler("handler")
                            .IsDisabled(func => {
                                func.Handler = "return !record.data.leaf;";
                            })
                    )
            )
            .Root(Model)
    )
}