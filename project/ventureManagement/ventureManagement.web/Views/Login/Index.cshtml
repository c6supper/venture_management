@using InputType = Ext.Net.InputType
@{
    ViewBag.Title = "水电工程施工安全隐患排查预警系统";
    Layout = "~/Views/Shared/_BaseLayout.cshtml";
}

@section headtag
{
<script>
    var imageVerificationCodeClick = function () {
        App.imageVerificationCode.setImageUrl("@Url.Action("VerificationCode")?" + new Date());
    };
</script>
}

@section menu
{
    @(
        Html.X().Window()
            .Closable(false)
            .CloseAction(CloseAction.Destroy)
            .Resizable(false)
            .Height(200)
            .Icon(Icon.Lock)
            .Title("水电工程施工安全隐患排查预警系统")
            .Draggable(false)
            .Width(350)
            .Modal(true)
            .BodyPadding(5)
            .Layout(LayoutType.Fit)
            .Items(
                Html.X().FormPanel()
                    .Layout(LayoutType.Form)
                    .Border(false)
                    .BodyStyle("background-color:transparent;")
                    .Items(
                        Html.X().TextField()
                            .ID("txtUsername")
                            .Icon(Icon.User)
                            .ReadOnly(false)
                            .FieldLabel("用户名")
                            .AllowBlank(false)
                            .BlankText("请输入用户名."),
                    
                        Html.X().TextField()
                            .ID("txtPassword")
                            .Icon(Icon.ApplicationKey)
                            .ReadOnly(false)
                            .InputType(InputType.Password)
                            .FieldLabel("密码")
                            .AllowBlank(false)
                            .BlankText("请输入密码."),
                            
                        Html.X().TextField()
                            .ID("verificationCode")
                            .AllowBlank(false)
                            .EmptyText("请输入验证码")
                            .FieldLabel("验证码"),
                        Html.X().Container()
                            .Padding(5)
                            .Layout(LayoutType.HBox)                  
                            .Items(
                                Html.X().Image()
                                    .Padding(5)
                                    .MinWidth(175)
                                    .ID("imageVerificationCode")
                                    .ImageUrl(Url.Action("VerificationCode","Login"))
                                    .Listeners(ls =>
                                    {
                                        ls.Click.Handler = "imageVerificationCodeClick();";
                                        ls.AfterRender.Handler = "imageVerificationCodeClick()";
                                    }),
                                Html.X().Button()
                                    .Padding(10)
                                    .Text("刷新验证码")
                                    .Handler("imageVerificationCodeClick();")
                            ),
                                              
                        Html.X().TagLabel()
                            .ID("txtStatus")
                            .TagString("")
                    )
            )                
            .Buttons(
                Html.X().Button()
                   .Text("注册")
                   .Icon(Icon.UserAdd)
                   .Handler("document.location.href='Register';"),            
                Html.X().Button()
                   .Text("登陆")
                   .Icon(Icon.UserTick)
                   .DirectEvents(de => {
                        de.Click.Action = "Login";
                        de.Click.EventMask.ShowMask = true;
                        de.Click.EventMask.Msg = "登录中...";
                        de.Click.EventMask.MinDelay = 1000;
                        de.Click.FormID = "#(return this.up('window').down('form');)";
                   })
            )
    )
}
